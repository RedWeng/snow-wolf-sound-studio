# å…¨ç«™é‚è¼¯æª¢æŸ¥å ±å‘Š - 2026-02-04

## æª¢æŸ¥ç¯„åœ
æŒ‰ç…§ç”¨æˆ¶æ—…ç¨‹é †åºæª¢æŸ¥æ‰€æœ‰é—œéµæµç¨‹çš„é‚è¼¯ä¸€è‡´æ€§

---

## ğŸ” ç™¼ç¾çš„å•é¡Œ

### 1. âš ï¸ é¦–é  â†’ ç™»å…¥æµç¨‹å•é¡Œ
**ä½ç½®**: `app/page.tsx`
**å•é¡Œ**: 
- é¦–é æŒ‰éˆ•é»æ“Šå¾Œè·³è½‰åˆ° `/login`
- ä½†é¦–é æ˜¯ç´”å±•ç¤ºé é¢ï¼Œæ²’æœ‰å°èˆªæ¬„
- ç”¨æˆ¶å¯èƒ½ä¸çŸ¥é“å¦‚ä½•è¿”å›é¦–é 

**å»ºè­°**: 
- åœ¨ç™»å…¥é æ·»åŠ "è¿”å›é¦–é "é€£çµ
- æˆ–åœ¨é¦–é æ·»åŠ æœ€å°åŒ–å°èˆªï¼ˆLogo + ç™»å…¥æŒ‰éˆ•ï¼‰

---

### 2. âš ï¸ ç™»å…¥å¾Œé‡å®šå‘é‚è¼¯
**ä½ç½®**: `app/login/page.tsx`
**ç•¶å‰é‚è¼¯**:
```typescript
const redirectTo = searchParams.get('redirect') || '/sessions';
```

**å•é¡Œ**: 
- æ–°ç”¨æˆ¶é¦–æ¬¡ç™»å…¥æœƒè‡ªå‹•è·³è½‰åˆ° `/sessions`
- ä½†æ–°ç”¨æˆ¶å¯èƒ½é‚„æ²’æœ‰å­©å­è³‡æ–™
- æ‡‰è©²å…ˆè·³è½‰åˆ° onboarding é é¢

**ç•¶å‰è™•ç†**:
```typescript
const needsOnboarding = localStorage.getItem('needs-onboarding') === 'true';
if (needsOnboarding) {
  router.push('/onboarding');
}
```

**ç‹€æ…‹**: âœ… å·²æ­£ç¢ºè™•ç†

---

### 3. âš ï¸ Sessions é é¢ - ç„¡å­©å­ç‹€æ…‹
**ä½ç½®**: `app/sessions/page.tsx`
**ç•¶å‰é‚è¼¯**:
- é¡¯ç¤º"å°šæœªæ–°å¢å­©å­"æç¤º
- æä¾›"ç™»å…¥/è¨»å†Š"æŒ‰éˆ•
- ä½†ç”¨æˆ¶å·²ç¶“ç™»å…¥äº†ï¼

**å•é¡Œ**: 
- æŒ‰éˆ•æ–‡å­—èª¤å°ï¼ˆç”¨æˆ¶å·²ç™»å…¥ï¼‰
- æ‡‰è©²æ˜¯"æ–°å¢å­©å­è³‡æ–™"æŒ‰éˆ•
- æ‡‰è©²è·³è½‰åˆ° `/onboarding` æˆ–ç›´æ¥æ‰“é–‹æ–°å¢å­©å­è¡¨å–®

**éœ€è¦ä¿®å¾©**: âœ… æ˜¯

---

### 4. âš ï¸ è³¼ç‰©è»Šèˆ‡çµå¸³æµç¨‹ä¸ä¸€è‡´
**ä½ç½®**: `app/sessions/page.tsx` vs `components/cart/CartSidebar.tsx`

**å•é¡Œ A - å…©å¥—è³¼ç‰©è»Šç³»çµ±**:
- Sessions é é¢ä½¿ç”¨æœ¬åœ° state: `const [cartItems, setCartItems] = useState<CartItem[]>([]);`
- ä½†æœ‰ CartContext æä¾›å…¨å±€è³¼ç‰©è»Šç®¡ç†
- å…©è€…æ²’æœ‰åŒæ­¥ï¼

**å•é¡Œ B - çµå¸³æµç¨‹**:
- Sessions é é¢: `localStorage.setItem('cart', JSON.stringify(cartItems));`
- CartContext: `localStorage.setItem('snow-wolf-cart', JSON.stringify(items));`
- ä½¿ç”¨ä¸åŒçš„ localStorage keyï¼

**éœ€è¦ä¿®å¾©**: âœ… æ˜¯ï¼ˆé«˜å„ªå…ˆç´šï¼‰

---

### 5. âš ï¸ è§’è‰²é¸æ“‡é‚è¼¯å•é¡Œ
**ä½ç½®**: `app/sessions/page.tsx`

**ç•¶å‰é‚è¼¯**:
```typescript
const allChildrenHaveRoles = hasRoles 
  ? selection?.childIds.every(cId => sessionRoleSelections[session.id]?.[cId]) || false
  : true;
```

**å•é¡Œ**:
- å¦‚æœèª²ç¨‹éœ€è¦è§’è‰²é¸æ“‡ï¼Œä½†ç”¨æˆ¶æ²’é¸è§’è‰²
- "åŠ å…¥å†’éšªè¡Œåˆ—"æŒ‰éˆ•æœƒè¢«ç¦ç”¨
- ä½†æ²’æœ‰æ˜ç¢ºæç¤ºç”¨æˆ¶"å¿…é ˆé¸æ“‡è§’è‰²"
- Tooltip åªåœ¨ hover æ™‚é¡¯ç¤º

**å»ºè­°**:
- æ·»åŠ æ›´æ˜é¡¯çš„æç¤ºï¼ˆç´…è‰²é‚Šæ¡†æˆ–è­¦å‘Šè¨Šæ¯ï¼‰
- æˆ–è‡ªå‹•å±•é–‹è§’è‰²é¸æ“‡å€åŸŸ

---

### 6. âš ï¸ å®¹é‡æ§åˆ¶é‚è¼¯
**ä½ç½®**: `app/sessions/page.tsx`

**ç•¶å‰é‚è¼¯**:
```typescript
const remaining = capacity - currentRegistrations;
const currentlySelected = existing.childIds.length;

if (remaining <= currentlySelected) {
  alert('æ­¤å ´æ¬¡å‰©é¤˜åé¡ä¸è¶³ï¼');
  return prev;
}
```

**å•é¡Œ**:
- ä½¿ç”¨ `alert()` ä¸å¤ å‹å–„
- æ‡‰è©²ä½¿ç”¨ Toast é€šçŸ¥æˆ– Modal

**å»ºè­°**: ä½¿ç”¨ Toast çµ„ä»¶

---

### 7. âš ï¸ å¾½ç« é é¢è¨ªå•æ¬Šé™
**ä½ç½®**: `app/badges/page.tsx`

**å•é¡Œ**:
- å¾½ç« é é¢æ²’æœ‰æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦ç™»å…¥
- æœªç™»å…¥ç”¨æˆ¶å¯ä»¥è¨ªå•ä½†çœ‹ä¸åˆ°ä»»ä½•å¾½ç« 
- æ‡‰è©²é‡å®šå‘åˆ°ç™»å…¥é 

**éœ€è¦ä¿®å¾©**: âœ… æ˜¯

---

### 8. âš ï¸ çµå¸³é é¢æ•¸æ“šä¾†æº
**ä½ç½®**: `app/checkout/page.tsx`

**éœ€è¦æª¢æŸ¥**:
- å¾å“ªè£¡è®€å–è³¼ç‰©è»Šæ•¸æ“šï¼Ÿ
- æ˜¯å¦èˆ‡ Sessions é é¢çš„ localStorage key ä¸€è‡´ï¼Ÿ
- æ˜¯å¦ä½¿ç”¨ CartContextï¼Ÿ

**å¾…ç¢ºèª**: éœ€è¦è®€å– checkout é é¢ä»£ç¢¼

---

### 9. âš ï¸ è¨‚å–®å®Œæˆå¾Œæµç¨‹
**ä½ç½®**: è¨‚å–®ç¢ºèªé é¢

**å•é¡Œ**:
- è¨‚å–®å®Œæˆå¾Œæ‡‰è©²ï¼š
  1. æ¸…ç©ºè³¼ç‰©è»Š
  2. ç™¼é€ç¢ºèªéƒµä»¶
  3. æˆäºˆå ±åå¾½ç« 
  4. è·³è½‰åˆ°è¨‚å–®è©³æƒ…é 

**éœ€è¦ç¢ºèª**: é€™äº›æ­¥é©Ÿæ˜¯å¦éƒ½å·²å¯¦ç¾

---

### 10. âš ï¸ ç®¡ç†å¾Œå° - å‡ºå¸­ç¢ºèª
**ä½ç½®**: `app/admin/sessions/[sessionId]/attendance/page.tsx`

**ç•¶å‰é‚è¼¯**:
- è€å¸«ç¢ºèªå‡ºå¸­å¾Œæˆäºˆå®Œæˆå¾½ç« 
- ä½†æ²’æœ‰æª¢æŸ¥æ˜¯å¦å·²ç¶“æœ‰å ±åå¾½ç« 

**å•é¡Œ**:
- å¦‚æœç”¨æˆ¶æ²’æœ‰å ±åå¾½ç« ï¼ˆç•°å¸¸æƒ…æ³ï¼‰
- ç›´æ¥æˆäºˆå®Œæˆå¾½ç« æœƒå°è‡´é‚è¼¯ä¸ä¸€è‡´

**å»ºè­°**: æ·»åŠ æª¢æŸ¥ï¼Œç¢ºä¿å ±åå¾½ç« å­˜åœ¨

---

## ğŸ”§ éœ€è¦ç«‹å³ä¿®å¾©çš„å•é¡Œ

### å„ªå…ˆç´š 1 - é«˜ï¼ˆå½±éŸ¿æ ¸å¿ƒæµç¨‹ï¼‰

1. **è³¼ç‰©è»Šç³»çµ±ä¸ä¸€è‡´** â­â­â­
   - Sessions é é¢æ‡‰è©²ä½¿ç”¨ CartContext
   - çµ±ä¸€ localStorage key
   - ç¢ºä¿æ•¸æ“šåŒæ­¥

2. **Sessions é é¢ç„¡å­©å­ç‹€æ…‹æŒ‰éˆ•** â­â­â­
   - ä¿®æ”¹æŒ‰éˆ•æ–‡å­—ç‚º"æ–°å¢å­©å­è³‡æ–™"
   - è·³è½‰åˆ°æ­£ç¢ºçš„é é¢

3. **å¾½ç« é é¢æ¬Šé™æ§åˆ¶** â­â­
   - æ·»åŠ ç™»å…¥æª¢æŸ¥
   - æœªç™»å…¥é‡å®šå‘åˆ°ç™»å…¥é 

### å„ªå…ˆç´š 2 - ä¸­ï¼ˆå½±éŸ¿ç”¨æˆ¶é«”é©—ï¼‰

4. **å®¹é‡æ§åˆ¶æç¤º** â­â­
   - ä½¿ç”¨ Toast æ›¿ä»£ alert()

5. **è§’è‰²é¸æ“‡æç¤º** â­â­
   - æ·»åŠ æ›´æ˜é¡¯çš„è¦–è¦ºæç¤º

6. **é¦–é å°èˆª** â­
   - æ·»åŠ è¿”å›é¦–é çš„æ–¹å¼

---

## ğŸ“‹ æª¢æŸ¥æ¸…å–®

### ç”¨æˆ¶æµç¨‹å®Œæ•´æ€§
- [ ] é¦–é  â†’ ç™»å…¥ â†’ Onboarding â†’ Sessions â†’ çµå¸³ â†’ è¨‚å–®ç¢ºèª
- [ ] è³¼ç‰©è»Šæ•¸æ“šåœ¨å„é é¢é–“æ­£ç¢ºå‚³é
- [ ] å¾½ç« ç³»çµ±æ­£ç¢ºæˆäºˆï¼ˆå ±å + å®Œæˆï¼‰
- [ ] ç®¡ç†å¾Œå°åŠŸèƒ½å®Œæ•´

### æ•¸æ“šä¸€è‡´æ€§
- [ ] localStorage keys çµ±ä¸€
- [ ] CartContext èˆ‡é é¢ state åŒæ­¥
- [ ] å¾½ç« æˆäºˆé‚è¼¯æ­£ç¢º

### éŒ¯èª¤è™•ç†
- [ ] ç„¡å­©å­ç‹€æ…‹è™•ç†
- [ ] å®¹é‡ä¸è¶³æç¤º
- [ ] è§’è‰²æœªé¸æ“‡æç¤º
- [ ] ç¶²çµ¡éŒ¯èª¤è™•ç†

---

## ğŸ¯ å»ºè­°çš„ä¿®å¾©é †åº

1. **ç«‹å³ä¿®å¾©**: è³¼ç‰©è»Šç³»çµ±çµ±ä¸€ï¼ˆSessions é é¢ä½¿ç”¨ CartContextï¼‰
2. **ç«‹å³ä¿®å¾©**: Sessions é é¢ç„¡å­©å­ç‹€æ…‹æŒ‰éˆ•
3. **çŸ­æœŸä¿®å¾©**: å¾½ç« é é¢æ¬Šé™æ§åˆ¶
4. **çŸ­æœŸä¿®å¾©**: æ”¹å–„æç¤ºæ–¹å¼ï¼ˆToastï¼‰
5. **é•·æœŸå„ªåŒ–**: é¦–é å°èˆªã€è§’è‰²é¸æ“‡ UX

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡Œå‹•

è«‹ç¢ºèªä»¥ä¸Šå•é¡Œï¼Œæˆ‘å°‡æŒ‰å„ªå…ˆç´šé€ä¸€ä¿®å¾©ã€‚
