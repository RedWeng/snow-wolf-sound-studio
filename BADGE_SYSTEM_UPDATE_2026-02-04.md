# 徽章系統更新 - 2026-02-04

## 更新內容

### 1. 里程碑獎勵文字更新 ✅

#### 8徽章獎勵
- **舊文字**：免費錄製一次雪狼男孩主題曲，後製到動畫MV上（無混音）
- **新文字**：免費錄製雪狼男孩主題曲，後製到動畫MV上（無混音）
- 移除了"一次"字樣

#### 16徽章獎勵
- **舊文字**：解鎖雪狼RPG遊戲帳號，開啟線上冒險！
- **新文字**：解鎖雪狼RPG遊戲帳號，開啟線上冒險！（預計6月上線）
- 新增"預計6月上線"資訊

### 2. 徽章顯示邏輯改變 ✅

#### 舊邏輯（去重）
- 兩個孩子都參加無字繪本場 → 只顯示1個無字繪本徽章
- 家庭總徽章數 = 去重後的徽章種類數

#### 新邏輯（不去重，累積計算）
- 兩個孩子都參加無字繪本場 → 顯示2個無字繪本徽章
- 每個徽章會顯示獲得次數標記（1/2, 2/2）
- 家庭總徽章數 = 所有孩子的徽章總和（不去重）
- 範例：
  - 小明：3個徽章
  - 小華：5個徽章
  - 家庭總計：8個徽章 ✓

#### 實現細節
- 使用 `badgeCountMap` 追蹤每個徽章被獲得的次數
- 在"全部徽章"視圖中，重複的徽章會顯示多次
- 每個重複徽章右上角顯示序號（1/2, 2/2等）
- 每個徽章下方顯示是哪位孩子獲得的

### 3. 新增所有徽章圖片 ✅

#### 現有課程徽章（14個）
已配置的7個課程，每個課程2個徽章（報名+完成）：
1. 無字繪本場 - 新手徽章、成長徽章
2. 動畫配音場 - 勇氣徽章、守護印記
3. 家庭動畫配音 - 愛心徽章、同心之帶
4. 時空冒險RPG - 召喚卷軸、星辰碎片
5. 古代神殿之謎 - 古代種子、古老聖杯
6. 卡達爾之戰 - 熱情徽章、守護之盾
7. 穆高爾傳說 - 森林種子、森林護符

#### 新增未來徽章（5個）
所有上傳的徽章圖片都已加入系統，未使用的顯示為"待解鎖"：
1. 草之靈 - 神秘的自然力量徽章（待解鎖）
2. 永生樹葉 - 永恆生命的象徵（待解鎖）
3. 星辰碎片·二 - 來自遙遠星系的碎片（待解鎖）
4. 守護之盾·二 - 更強大的守護力量（待解鎖）
5. 守護之盾·三 - 終極守護之力（待解鎖）

#### 徽章總數
- **現有課程徽章**：14個（7課程 × 2）
- **未來徽章**：5個
- **總計**：19個徽章

### 4. 待解鎖狀態顯示 ✅

#### 視覺效果
- 未獲得的徽章顯示為灰階（grayscale filter）
- 顯示鎖頭圖示覆蓋層
- 描述文字改為"待解鎖"（中文）或"Locked"（英文）
- 降低透明度（opacity: 40%）

#### 互動效果
- 滑鼠懸停時透明度提升至60%
- 已獲得的徽章可以放大（hover:scale-105）
- 已獲得的徽章有稀有度光暈效果

## 技術實現

### 修改的檔案
1. `lib/config/badges.ts`
   - 更新里程碑獎勵文字
   - 新增 `futureBadges` 陣列
   - 新增 `getAllBadgesIncludingFuture()` 函數
   - 更新 `getAllBadges()` 包含未來徽章

2. `components/badges/FamilyBadgeVault.tsx`
   - 新增 `badgeCountMap` 追蹤徽章獲得次數
   - 修改顯示邏輯支援重複徽章
   - 為重複徽章添加序號標記
   - 保持家庭總徽章數累積計算（不去重）

3. `components/badges/BadgeCard.tsx`
   - 更新未獲得徽章的描述顯示為"待解鎖"

### 資料結構
```typescript
// 徽章計數 Map
const badgeCountMap = new Map<string, number>();
// 範例：
// "badge-wordless-registration" -> 2 (兩個孩子都獲得)
// "badge-animation-registration" -> 1 (一個孩子獲得)

// 家庭總徽章數（累積，不去重）
const totalFamilyBadges = familyBadges.reduce((total, child) => {
  return total + child.earnedBadgeIds.length;
}, 0);
```

## 部署狀態
✅ 已部署到正式環境
🔗 網址：https://snow-wolf-sound-studio.vercel.app

## 測試建議
1. 訪問徽章收藏頁面 `/badges`
2. 驗證里程碑獎勵文字已更新
3. 測試重複徽章顯示：
   - 創建兩個孩子
   - 讓兩個孩子都參加同一課程
   - 確認該課程徽章顯示2次，並有序號標記
4. 驗證家庭總徽章數為累積計算（不去重）
5. 確認所有19個徽章都顯示在收藏頁面
6. 驗證未獲得的徽章顯示"待解鎖"

## 使用者體驗改善
- ✅ 更清楚的徽章累積邏輯（符合付費邏輯）
- ✅ 視覺化顯示每個徽章的獲得次數
- ✅ 完整的徽章收藏展示（包含未來徽章）
- ✅ 明確的鎖定/解鎖狀態
- ✅ 更新的里程碑獎勵資訊
